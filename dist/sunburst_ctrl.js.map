{"version":3,"sources":["../src/sunburst_ctrl.js"],"names":[],"mappings":"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","file":"sunburst_ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport TimeSeries from 'app/core/time_series';\nimport rendering from './rendering';\n\nexport class SunburstCtrl extends MetricsPanelCtrl {\n\n  constructor($scope, $injector, $rootScope) {\n    super($scope, $injector);\n    this.$rootScope = $rootScope;\n\n    this.columnTypes = [\n      {text: 'Number', value: 'number'},\n      {text: 'String', value: 'string'},\n      {text: 'Date', value: 'date'},\n    ];\n\n    this.dateFormats = [\n      {text: 'YYYY-MM-DD HH:mm:ss', value: 'YYYY-MM-DD HH:mm:ss'},\n      {text: 'MM/DD/YY h:mm:ss a', value: 'MM/DD/YY h:mm:ss a'},\n      {text: 'MMMM D, YYYY LT',  value: 'MMMM D, YYYY LT'},\n    ];\n\n    this.unitFormats = kbn.getUnitFormats();\n\n    var panelDefault = {\n      graphType: 'bar',\n      styles: {},\n      rootKey: 'root',\n    };\n    _.defaults(this.panel, panelDefault);\n\n    this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/grafana-sunburst-panel/editor.html', 2);\n  }\n\n  onDataError() {\n    this.series = [];\n    this.render();\n  }\n\n  onRender() {\n    this.data = this.parseSeries(this.series);\n  }\n\n  parseSeries(series) {\n    return _.map(this.series, (serie, i) => {\n      return {\n        label: serie.alias,\n        datapoints: serie.datapoints\n      };\n    });\n  }\n\n  setUnitFormat(style, subItem) {\n    style.unit = subItem.value;\n    this.render(this.data);\n  };\n\n  onDataReceived(dataList) {\n    this.series = dataList.map(this.seriesHandler.bind(this));\n    this.data = this.parseSeries(this.series);\n\n    this.initStyles();\n\n    this.render(this.data);\n  }\n\n  seriesHandler(seriesData) {\n    var series = new TimeSeries({\n      datapoints: seriesData.datapoints,\n      alias: seriesData.target\n    });\n\n    return series;\n  }\n\n  initStyles() {\n    if (this.data.length === 0 || this.data[0].datapoints.length === 0) {\n      return;\n    }\n\n    var keys = _.keys(this.data[0].datapoints[0]);\n\n    var self = this;\n    var styles = {};\n    _.each(keys, function(key, i) {\n      if (self.panel.styles[key]) {\n        styles[key] = self.panel.styles[key];\n      } else {\n        var type = (i === keys.length - 1) ? 'number' : 'string';\n        styles[key] = {\n          type: 'string', unit: 'none', decimals: null\n        };\n      }\n    });\n    this.panel.styles = styles;\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    this.sunburst = rendering(scope, elem, attrs, ctrl);\n  }\n}\n\nSunburstCtrl.templateUrl = 'module.html';\n"]}